Issue author: @HFaustt
PR plan author: @phaedrusflow (https://github.com/phaedrusflow)
Organization: @qompassai (https://github.com/qompassai)
Author IDs: \[user-id: 70476764] \[org-id: 137334444]

# WIP PR plan for #4097 – No output to select entire screen in portal share picker

Labels: bug
Repo: basecamp/omarchy
Upstream issue: https://github.com/basecamp/omarchy/issues/4097

***

## Legend

* **D#** – Diff / behavior change
* **F#** – File added/changed/removed
* **T#** – Test / verification step
* **R#** – References

***

## Summary

* D1: \[Correct xdg desktop preview share]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)

## Upstream issue context (snippet)

```text
### System details
Omarchy 3.2.3
<img width="411" height="422" alt="Image" src="https://github.com/user-attachments/assets/d7777a93-70e9-42e0-b3a3-ca6e9bc178c8" />

### What's wrong?
<img width="1858" height="1120" alt="Image" src="https://github.com/user-attachments/assets/311decdb-1dc1-4487-8573-ecb8ce56f315" />

I can't select entire screen and the output doesn't show anything. 
```

## Proposed Changes

* D1: \[describe change #1]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)
* D2: \[describe change #2]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)
* D3: \[describe change #3]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)

## Files

* F1: [`./4097-pr/install/config/xdg-desktop-portal.sh`](./4097-xdgportal/install/config/xdg-desktop.sh)
  * Purpose: \[added vars for ]
  * Lines: \[`envs.conf#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/4097/default/hypr/envs.conf#L18-L24>)
* F2: [`./4097/default/hypr/start.conf`](./4097/default/hypr/start.conf)
  * Purpose: \[what this file does in this PR]
  * Lines: \[`start.conf#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/4097/default/hypr/start.conf#Lxx-Lyy>)
* F3: [`./4097/install/...`](./4097/install/...)
  * Purpose: \[install / helper scripts]
  * Lines: \[`install#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/4097/install/<path>#Lxx-Lyy>)
* F4: \[additional file]
  * Purpose: \[what this file does]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)

## Linked issues

1. \#3930: Glitching first frame on captured videos <https://github.com/basecamp/omarchy/issues/3930>
2. \#4070: Cannot record audio via built in stereo microphone <https://github.com/basecamp/omarchy/issues/4070>
3. \#4242: System UI/Screen freezes on video playback after updating to latest version <https://github.com/basecamp/omarchy/issues/4242>

## Testing

* T1: Validate desktop files with desktop-file-utils
  * Command: `desktop-file-validate $XDG_DATA_HOME/applications/*.desktop`
  * Purpose: Ensure all desktop entries comply with FreeDesktop specification

* T2: Pass XDG Desktop Portal integration test
  * Script: [`tests/4097/4097.sh`](https://github.com/qompassai/arch/blob/main/omarchy/tests/4097/4097.sh)
  * Purpose: Verify portal configuration, D-Bus services, and Hyprland/GTK portal implementations
  * Expected behavior:
    * Portal D-Bus introspection succeeds
    * `portals.conf` preferences are correctly applied
    * ScreenCast (Hyprland), FileChooser (GTK), and Notifications work
  * Lines: [`4097.sh#L1-L150`](https://github.com/qompassai/omarchy/blob/<sha>/tests/4097/4097.sh#L1-L150)

* T3: \[test description]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)

* T4: \[test description]
  * Lines: \[`<file>#Lxx-Lyy`]\(\<https://github.com/<owner>/<repo>/blob/<sha>/<path>#Lxx-Lyy>)

## References

<!-- <sup><a href="#ref1">[1]</a></sup> -->

<div id="footnotes">
<p id="R1"><strong>[1]</strong> <a href="https://flatpak.github.io/xdg-desktop-portal/docs/impl-dbus-interfaces.html">XDG Desktop API Docs</a></p>

<p id="R2"><strong>[2]</strong> <a href="https://wiki.archlinux.org/title/XDG_Desktop_Portal ">Arch Wiki XDG Desktop Portal</a></p>

<p id="R3"><strong>[3]</strong> <a href="https://wiki.archlinux.org/title/XDG_Base_Directory">Arch Wiki XDG Base Directory</a></p>

<p id="R4"><strong>[4]</strong> <a href="https://specifications.freedesktop.org/basedir/latest/">XDG Base Directory Specification</a></p>

<p id="R5"><strong>[5]</strong> <a href="https://wiki.archlinux.org/title/XDG_user_directories">Arch Wiki XDG User Directories</a></p>
</div>
