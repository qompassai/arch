# 00-toolchain.conf
# Qompass AI Makepkg.conf.d Toolchain Config
# Copyright (C) 2025 Qompass AI, All rights reserved
#####################################################
# Env toggles:
#   USE_CLANG=1     -> force clang even if zig is installed
#   USE_MUSL=1      -> zig targets musl instead of glibc
#   USE_NATIVE=1    -> use -march=native later (see 20-native.conf)

if [ "${USE_CLANG:-0}" -eq 1 ]; then
  unset ZIG
fi
if command -v zig >/dev/null 2>&1; then
  ZIG=${ZIG:-/usr/bin/zig}
  if [ "${USE_MUSL:-0}" -eq 1 ]; then
    ZIG_TARGET=${ZIG_TARGET:-x86_64-linux-musl}
  else
    ZIG_TARGET=${ZIG_TARGET:-x86_64-linux-gnu}
  fi
  CC="$ZIG cc -target ${ZIG_TARGET}"
  CXX="$ZIG c++ -target ${ZIG_TARGET}"
  AR="$ZIG ar"
  NM="$ZIG nm"
  RANLIB="$ZIG ranlib"
  STRIP="$ZIG strip"
else
  CC=clang
  CXX=clang++
  AR=llvm-ar
  NM=llvm-nm
  RANLIB=llvm-ranlib
  STRIP=llvm-strip
fi
if command -v mold >/dev/null 2>&1; then
  LDFLAGS="${LDFLAGS} -fuse-ld=mold"
elif command -v ld.lld >/dev/null 2>&1; then
  LDFLAGS="${LDFLAGS} -fuse-ld=lld"
fi
